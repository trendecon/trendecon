<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating long daily series • trendecon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating long daily series">
<meta property="og:description" content="trendecon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trendecon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/daily-series.html">Creating long daily series</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to trendecon</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/trendecon/trendecon/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating long daily series</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/trendecon/trendecon/blob/HEAD/vignettes/daily-series.Rmd" class="external-link"><code>vignettes/daily-series.Rmd</code></a></small>
      <div class="hidden name"><code>daily-series.Rmd</code></div>

    </div>

    
    
<p>Once the combination of useful keywords is selected we might want to use them as economic indicators in production and display them on <a href="https://www.trendecon.org/" class="external-link">trendecon.org</a>. This vignette describes the steps for adding new indicators to the production processes of “Trendecon”.</p>
<div class="section level2">
<h2 id="directory-structure">Directory structure<a class="anchor" aria-label="anchor" href="#directory-structure"></a>
</h2>
<p>The names of production functions within the <code>trendecon</code> package start with <code>proc_</code>. They usually operate on the file system which means that calling these functions will write files to the local disk. The <code>proc_</code> functions will save files within two folders: <code>data</code> and <code>raw</code>, which are located under the working directory (<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>). <code>raw</code> folder holds all the data downloaded from Google, plus some transformations, such as seasonally adjusted or combined series. <code>data</code> folder, on the other hand, collects the final indicators - the data displayed on the website. If not present these folders will be created when calling <code>proc_keyword_init</code> for the first time.</p>
<p>Within these folders, every used <code>geo</code> location will have its own subfolder. Thus, in the end, if we used Swiss and Austrian indicators, we would end up with the following directory structure:</p>
<pre><code>│
├── data
│   ├── at
│   └── ch
│
└── raw
    ├── at
    └── ch</code></pre>
</div>
<div class="section level2">
<h2 id="creating-a-new-series">Creating a new series<a class="anchor" aria-label="anchor" href="#creating-a-new-series"></a>
</h2>
<p>In order to create a new series we need to go through several steps:</p>
<ol style="list-style-type: decimal">
<li>Select a set of Google Trends keywords comprising the new series</li>
<li>Download the data for each keyword and store it in the <a href="https://github.com/trendecon/data" class="external-link">trendecon/data</a> repository.</li>
<li>Create the series using the downloaded data files.</li>
<li>Include the series and its keywords within the daily updates.</li>
</ol>
<div class="section level3">
<h3 id="selecting-keywords">1) Selecting keywords<a class="anchor" aria-label="anchor" href="#selecting-keywords"></a>
</h3>
<p>As a rule an series is composed of multiple related keywords and a geographical location. For example purposes an series “homeoffice” will be created for “ch” (Switzerland) using “headset”, “monitor”, “maus”, and “hdmi” keywords.</p>
</div>
<div class="section level3">
<h3 id="downloading-data">2) Downloading data<a class="anchor" aria-label="anchor" href="#downloading-data"></a>
</h3>
<p>To include a new series, each keyword must first be initiated. Our goal is to produce long daily time series, ideally ranging from 2006. However, Google does not provide daily or weekly data for such a long time period. Hence, we need to circumvent the problem by applying a moving window of daily and weekly queries over the whole time period. So be careful, as this causes a lot of queries to Google and might result in a temporary IP address ban.</p>
<p>The commands below will download the data for our example series:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/proc_keyword_init.html">proc_keyword_init</a></span><span class="op">(</span><span class="st">"headset"</span>, <span class="st">"CH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/proc_keyword_init.html">proc_keyword_init</a></span><span class="op">(</span><span class="st">"monitor"</span>, <span class="st">"CH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/proc_keyword_init.html">proc_keyword_init</a></span><span class="op">(</span><span class="st">"maus"</span>, <span class="st">"CH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/proc_keyword_init.html">proc_keyword_init</a></span><span class="op">(</span><span class="st">"hdmi"</span>, <span class="st">"CH"</span><span class="op">)</span></span></code></pre></div>
<p>After running the code above we will have the aggregated series at daily, weekly and monthly frequency, stored in the <code>raw</code> folder. For example, the files of the “headset” keyword will be stored under: <code>raw/ch/headset_d.csv</code>, <code>raw/ch/headset_w.csv</code>, and <code>raw/ch/headset_m.csv</code>. Analogous files will be present for the remaining 3 keywords.</p>
</div>
<div class="section level3">
<h3 id="creating-a-series">3) Creating a series<a class="anchor" aria-label="anchor" href="#creating-a-series"></a>
</h3>
<p>Four actions need to be performed in order to combine multiple keywords under a single series:</p>
<ol style="list-style-type: decimal">
<li>Update each keyword by downloading the latest data.</li>
<li>Combine daily, weekly, and monthly frequencies within each keyword.</li>
<li>Remove seasonal patterns from the keyword data.</li>
<li>Combine all the prepared keywords and create a series.</li>
</ol>
<p>All the above steps are performed by a single function call:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/proc_index.html">proc_index</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"headset"</span>, <span class="st">"monitor"</span>, <span class="st">"maus"</span>, <span class="st">"hdmi"</span><span class="op">)</span>, <span class="st">"CH"</span>, <span class="st">"homeoffice"</span><span class="op">)</span></span></code></pre></div>
<p>This function will combine the keywords passed as the first argument and store the resulting series under the name specified by the third argument. In this example a new file holding the data for “homeoffice” series will be created under <code>data/ch/homeoffice_sa_csv</code>. In addition, for each series, two intermediate preparation files will also be created, i.e. <code>raw/ch/headset_mwd.csv</code> and <code>raw/ch/headset_sa.csv</code>. Here “mwd” stores the combined monthly/weekly/daily data and “sa” contains the values after seasonal adjustment.</p>
<p>P.S. The same function <code><a href="../reference/proc_index.html">proc_index()</a></code> is also used for updating the data of an existing data series.</p>
</div>
<div class="section level3">
<h3 id="adding-daily-updates">4) Adding daily updates<a class="anchor" aria-label="anchor" href="#adding-daily-updates"></a>
</h3>
<p>Last step is to include the newly created series into a daily-update script. First - all the files prepared in steps 1-3 need to be added to <a href="https://github.com/trendecon/data" class="external-link">trendecon/data</a> repository. Then, in order to schedule daily updates, the script <code>proc_trendecon_ch.R</code> in the <a href="https://github.com/trendecon/trendecon" class="external-link">trendecon/trendecon</a> repository has to be modified. Note that the end of the file (“ch”) specifies geographic location and so for other locations (like “de”) there will be a separate file (i.e. <code>proc_trendecon_de.R</code>)</p>
<p>In order to add the series used in the example to this script 3 changes are needed:</p>
<ol style="list-style-type: decimal">
<li>
<p>create a variable holding the set of keywords used for the series:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kw_homeoffice</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"headset"</span>,</span>
<span>  <span class="st">"monitor"</span>,</span>
<span>  <span class="st">"maus"</span>,</span>
<span>  <span class="st">"hdmi"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>add a function call that creates/updates this series:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/proc_index.html">proc_index</a></span><span class="op">(</span><span class="va">kw_homeoffice</span>, <span class="st">"CH"</span>, <span class="st">"homeoffice"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>add the name of this series to production list:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>indices_in_production <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>...<span class="sc">&gt;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"homeoffice"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</li>
</ol>
<p>After that simply add the updated version of this scrip to <a href="https://github.com/trendecon/trendecon" class="external-link">trendecon/trendecon</a> repository and all is set.</p>
<p>The <code>proc_trendecon_</code> functions produce the final indicators that we show on <a href="https://www.trendecon.org/" class="external-link">trendecon.org</a>. They are called by an automated process which is set up on GitHub, so we do not need to call them manually when updating the data. The full list of active Swiss indicators can be found within the code of <code><a href="../reference/proc_trendecon_ch.html">proc_trendecon_ch()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="series-creation-steps">Series creation steps<a class="anchor" aria-label="anchor" href="#series-creation-steps"></a>
</h2>
<p>To get a better understanding of how multiple keywords are combined into a single series we need to examine the inner working of <code><a href="../reference/proc_index.html">proc_index()</a></code> function. The steps of series preparation are outlined below. Note that the functions displayed in this section are internal and typically are not called by the users.</p>
<div class="section level3">
<h3 id="step-1-update-with-latest-data">Step 1: update with latest data<a class="anchor" aria-label="anchor" href="#step-1-update-with-latest-data"></a>
</h3>
<p>In the first step, the raw data series for each keyword are updated with the latest daily, weekly, and monthly data. For example, to update the raw series for keyword <code>"Rezession"</code> for Switzerland, the script calls the following internal function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/proc_keyword_latest.html">proc_keyword_latest</a></span><span class="op">(</span><span class="st">"Rezession"</span>, <span class="st">"CH"</span><span class="op">)</span></span></code></pre></div>
<p>This function downloads raw daily, weekly, and monthly data for the specified pair of keyword and geo location. If the data for a particular keyword is not yet available, <code><a href="../reference/proc_keyword_init.html">proc_keyword_init()</a></code> should be called instead.</p>
</div>
<div class="section level3">
<h3 id="step-2-bending">Step 2: bending<a class="anchor" aria-label="anchor" href="#step-2-bending"></a>
</h3>
<p>To combine the three frequencies (monthly, weekly, and daily), we apply the following methodology: in a first step, we “bend” the daily series to the weekly values, by applying a variant of the Chow-Lin (1971) method. This preserves the movement of the daily series and ensures that weekly averages are identical to the original weekly series. We then use the same methodology to bend the series to the monthly values.</p>
<p>To combine the three frequencies for a given keyword, the script calls another internal function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">proc_combine_freq</span><span class="op">(</span><span class="st">"Rezession"</span>, <span class="st">"CH"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-seasonal-adjustment">Step 3: seasonal adjustment<a class="anchor" aria-label="anchor" href="#step-3-seasonal-adjustment"></a>
</h3>
<p>Some keywords’ time series might display seasonal patterns. For example it is not surprising that searches for gardening are higher in spring. In order to make meaningful comparisons over time such seasonal patterns, present within the data, need to be removed. To achieve this <code>trendecon</code> uses the “Prophet” procedure for estimating an additive model where non-linear trends are fit with yearly and weekly seasonality and the holiday effects.</p>
<p>To seasonally adjust a combined keyword, the script calls the following internal function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">proc_seas_adj</span><span class="op">(</span><span class="st">"Rezession"</span>, <span class="st">"CH"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-combining">Step 4: combining<a class="anchor" aria-label="anchor" href="#step-4-combining"></a>
</h3>
<p>Once the raw data for each keyword has been processed we end up with multiple time series - one for each keyword within the indicator. As an example the main indicator uses the following keywords: <code>"Wirtschaftskrise"</code>, <code>"Kurzarbeit "</code>, <code>"arbeitslos"</code>, and <code>"Insolvenz"</code>. To turn several provided keywords into a single time series the first principal component is used.</p>
<p>In order to achieve this the script calls <code>ts_prcomp()</code> function from the <code>tsbox</code> package.</p>
</div>
<div class="section level3">
<h3 id="step-5-writing-the-data">Step 5: writing the data<a class="anchor" aria-label="anchor" href="#step-5-writing-the-data"></a>
</h3>
<p>Finally the prepared index is saved to a file in the data folder:</p>
<pre><code><span><span class="fu"><a href="../reference/write_keyword.html">write_keyword</a></span><span class="op">(</span><span class="va">prepared_data</span>, <span class="st">"indicator"</span>, <span class="st">"CH"</span><span class="op">)</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Angelica Becerra, Nina Mühlebach, Christoph Sax, Sverin Thoeni, Uwe Thuemmel, Karolis Koncevičius.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
